import pdb

def parse_aps_articles(article_string):
	# Get the necessary information for an article:
	article = {}

	# Use the same keys as fields in JournalArticle to 
	# allow for easy transfer later on in the pipeline
	pdf_link = article_string.split('"pdf":{"link":')[1]
	pdf_link = article_string.split(',"label":"PDF"')[0]
	article["file_urls"] = pdf_link

	title = article_string.split('"title":')[1]
	title = article_string.split('"')	
	article["title"] = article_string.split()

def parse_aps(raw_string):
	# The approach to parsing the returned script is to find the locations
	# of the start and end of article listings. We then search these ranges
	# one at a time for the desired information.
	article_start_inds = []
	article_end_inds = []
	bracket_level = 0
	c_ind = 0
	for c in raw_string:
		if c == "{":
			bracket_level += 1
			# A bracket level of 1 means a new article has started,
			# keep track of its index
			if bracket_level == 1:
				article_start_inds.append(c_ind)
		elif c == "}":
			bracket_level -= 1
			# A bracket level of 0 means we have closed all brackets,
			# thereby ending an article. Keep track of this index
			if bracket_level == 0:
				article_end_inds.append(c_ind)
		c_ind += 1

	assert(len(article_start_inds) == len(article_end_inds))

	# Now go back and extract the necessary information from each article section:
	articles = []
	for i in range(len(article_start_inds)):
		articles.append(parse_aps_article(raw_string[article_start_inds[i]:article_end_inds[i]]))


	pdb.set_trace()
	return articles


s = '<script>window.criteria = {"article_type":[{"value":"viewpoint","label":"Viewpoint"},{"value":"focus","label":"Focus"},{"value":"feature","label":"Features"},{"value":"synopsis","label":"Synopsis"},{"value":"editorial","label":"Notes from the Editors"},{"value":"trend","label":"Trends"},{"value":"letter-to-editor","label":"Letter to the Editor"},{"value":"reply","label":"Reply"}],"subject_area":[{"value":"acoustics","label":"Acoustics"},{"value":"astrophysics","label":"Astrophysics"},{"value":"atomic-molecular","label":"Atomic and Molecular Physics"},{"value":"biological","label":"Biological Physics"},{"value":"chemical","label":"Chemical Physics"},{"value":"complex-systems","label":"Complex Systems"},{"value":"computational","label":"Computational Physics"},{"value":"cond-matt","label":"Condensed Matter Physics"},{"value":"cosmology","label":"Cosmology"},{"value":"electronics","label":"Electronics"},{"value":"energy","label":"Energy Research"},{"value":"fluids","label":"Fluid Dynamics"},{"value":"geophysics","label":"Geophysics"},{"value":"graphene","label":"Graphene"},{"value":"gravitation","label":"Gravitation"},{"value":"industrial","label":"Industrial Physics"},{"value":"interdisciplinary","label":"Interdisciplinary Physics"},{"value":"magnetism","label":"Magnetism"},{"value":"materials","label":"Materials Science"},{"value":"mechanics","label":"Mechanics"},{"value":"medical","label":"Medical Physics"},{"value":"mesoscopics","label":"Mesoscopics"},{"value":"metamaterials","label":"Metamaterials"},{"value":"nano","label":"Nanophysics"},{"value":"nonlinear","label":"Nonlinear Dynamics"},{"value":"nuclear","label":"Nuclear Physics"},{"value":"optics","label":"Optics"},{"value":"optoelectronics","label":"Optoelectronics"},{"value":"particles-fields","label":"Particles and Fields"},{"value":"photonics","label":"Photonics"},{"value":"phys-chem","label":"Physical Chemistry"},{"value":"plasma","label":"Plasma Physics"},{"value":"plasmonics","label":"Plasmonics"},{"value":"quantum","label":"Quantum Physics"},{"value":"quantum-info","label":"Quantum Information"},{"value":"semiconductor","label":"Semiconductor Physics"},{"value":"soft-matter","label":"Soft Matter"},{"value":"spintronics","label":"Spintronics"},{"value":"statistical","label":"Statistical Physics"},{"value":"strings","label":"String Theory"},{"value":"strongly-correlated","label":"Strongly Correlated Materials"},{"value":"superconductivity","label":"Superconductivity"},{"value":"superfluids","label":"Superfluidity"},{"value":"top-insulator","label":"Topological Insulators"}],"date":"","per_page":"10","sort":"recent","dateOptions":[{"label":"Any time","value":""},{"label":"Past Week","value":"week"},{"label":"Past Month","value":"month"},{"label":"Past year","value":"year"},{"label":"Custom","value":"custom"}],"sortOptions":[{"label":"Most Relevant","value":"relevance"},{"label":"Most Recent","value":"recent"},{"label":"Oldest First","value":"oldest"}],"perPageOptions":[{"label":"10","value":"10"},{"label":"20","value":"20"},{"label":"50","value":"50"},{"label":"100","value":"100"}]};\nwindow.results = {"hits":[{"actions":{"pdf":{"link":"http://link.aps.org/doi/10.1103/Physics.10.40","label":"PDF"},"html":{"link":"/articles/v10/40#fulltext","label":"HTML"}},"id":"10.1103/Physics.10.40","index":"content-v1-1","type":"article","score":0.21782525,"article_type":"focus","date":"2017-04-14","date_label":"April 14, 2017","citation":"","journal":"Physics","authors":"David Lindley","doi":"10.1103/Physics.10.40","features":[],"summary":null,"title":"Focus: Why Sediments Are So Uniform","link":"/articles/v10/40","teaser":"A new theory suggests that sedimenting particles of irregular shape will drift horizontally as they fall, a result that may resolve a long-standing puzzle.","subject_areas":[{"link":"physics/subjects/fluids","label":"Fluid Dynamics"}],"image":"http://physics.aps.org/assets/10.1103/Physics.10.40/figure/1/thumb"},{"actions":{},"id":"7074F2F4-287E-1E92-40F2-6625BA06E9AE","index":"content-v1-1","type":"article","score":0.2154827,"article_type":"synopsis","date":"2017-04-13","date_label":"April 13, 2017","citation":"","journal":"Physics","doi":null,"features":[],"summary":null,"title":"Synopsis: A Room-Sized Linear Accelerator for Proton Therapy","link":"/synopsis-for/10.1103/PhysRevAccelBeams.20.040101","teaser":"A new design of a proton accelerator for cancer treatment is fully linear and compact.","subject_areas":[{"link":"physics/subjects/medical","label":"Medical Physics"}],"image":"//d22izw7byeupn1.cloudfront.net/journals/PHYSICS/synopses/images/10.1103/PhysRevAccelBeams.20.040101"},{"actions":{"pdf":{"link":"http://link.aps.org/doi/10.1103/Physics.10.39","label":"PDF"},"html":{"link":"/articles/v10/39#fulltext","label":"HTML"}},"id":"10.1103/Physics.10.39","index":"content-v1-1","type":"article","score":0.21832405,"article_type":"viewpoint","date":"2017-04-12","date_label":"April 12, 2017","citation":"","journal":"Physics","authors":"Bradley Siwick","doi":"10.1103/Physics.10.39","features":[],"summary":null,"title":"Viewpoint: Electron Pulses Made Faster Than Atomic Motions","link":"/articles/v10/39","teaser":"Electron pulses have shattered the 10-femtosecond barrier at which essentially all atomic motion is frozen in materials.","subject_areas":[{"link":"physics/subjects/atomic-molecular","label":"Atomic and Molecular Physics"},{"link":"physics/subjects/materials","label":"Materials Science"},{"link":"physics/subjects/plasma","label":"Plasma Physics"}],"image":"http://physics.aps.org/assets/10.1103/Physics.10.39/figure/1/thumb"},{"actions":{},"id":"36268BDA-AD65-636F-EB7A-77473385DEB8","index":"content-v1-1","type":"article","score":0.21782525,"article_type":"synopsis","date":"2017-04-12","date_label":"April 12, 2017","citation":"","journal":"Physics","doi":null,"features":[],"summary":null,"title":"Synopsis: Speeding Up Battery Charging with Quantum Physics","link":"/synopsis-for/10.1103/PhysRevLett.118.150601","teaser":"Calculations show that charging a set of batteries can go faster if the batteries are coupled together quantum mechanically.","subject_areas":[{"link":"physics/subjects/quantum","label":"Quantum Physics"}],"image":"//d22izw7byeupn1.cloudfront.net/journals/PHYSICS/synopses/images/10.1103/PhysRevLett.118.150601"},{"actions":{},"id":"3E30F610-AF9D-0299-EE30-F57A99D737CD","index":"content-v1-1","type":"article","score":0.21646123,"article_type":"synopsis","date":"2017-04-11","date_label":"April 11, 2017","citation":"","journal":"Physics","doi":null,"features":[],"summary":null,"title":"Synopsis: Jiggles that Help Bat Biosonar","link":"/synopsis-for/10.1103/PhysRevLett.118.158102","teaser":"The directional sensitivity of bat biosonar is improved by the wiggling of structures on the bat\u2019s nose and ears.","subject_areas":[{"link":"physics/subjects/biological","label":"Biological Physics"},{"link":"physics/subjects/acoustics","label":"Acoustics"}],"image":"//d22izw7byeupn1.cloudfront.net/journals/PHYSICS/synopses/images/10.1103/PhysRevLett.118.158102"},{"actions":{"pdf":{"link":"http://link.aps.org/doi/10.1103/Physics.10.38","label":"PDF"},"html":{"link":"/articles/v10/38#fulltext","label":"HTML"}},"id":"10.1103/Physics.10.38","index":"content-v1-1","type":"article","score":0.2189774,"article_type":"viewpoint","date":"2017-04-10","date_label":"April 10, 2017","citation":"","journal":"Physics","authors":"Robert Sewell","doi":"10.1103/Physics.10.38","features":[],"summary":null,"title":"Viewpoint: Photonic Hat Trick","link":"/articles/v10/38","teaser":"Two independent groups have provided the first experimental demonstration of genuine three-photon interference.","subject_areas":[{"link":"physics/subjects/optics","label":"Optics"},{"link":"physics/subjects/quantum-info","label":"Quantum Information"},{"link":"physics/subjects/quantum","label":"Quantum Physics"}],"image":"http://physics.aps.org/assets/10.1103/Physics.10.38/figure/1/thumb"},{"actions":{"pdf":{"link":"http://link.aps.org/doi/10.1103/Physics.10.37","label":"PDF"},"html":{"link":"/articles/v10/37#fulltext","label":"HTML"}},"id":"10.1103/Physics.10.37","index":"content-v1-1","type":"article","score":0.21646123,"article_type":"focus","date":"2017-04-07","date_label":"April  7, 2017","citation":"","journal":"Physics","authors":"Michael Schirber","doi":"10.1103/Physics.10.37","features":[],"summary":null,"title":"Focus: Making Rogue Waves with Wind and Water","link":"/articles/v10/37","teaser":"Wind-generated waves in a ring-shaped water tank can spontaneously grow into single behemoth waves, mimicking a poorly understood ocean phenomenon. \xa0","subject_areas":[{"link":"physics/subjects/fluids","label":"Fluid Dynamics"}],"image":"http://physics.aps.org/assets/10.1103/Physics.10.37/figure/1/thumb"},{"actions":{},"id":"61498BD9-0D5A-0625-B765-F4C4BBF54E72","index":"content-v1-1","type":"article","score":0.2154827,"article_type":"synopsis","date":"2017-04-06","date_label":"April  6, 2017","citation":"","journal":"Physics","doi":null,"features":[],"summary":null,"title":"Synopsis: The Square Root to Topological States","link":"/synopsis-for/10.1103/PhysRevB.95.165109","teaser":"A theoretical recipe generates a lattice with topological states by taking the square root of a normal lattice.","subject_areas":[{"link":"physics/subjects/top-insulator","label":"Topological Insulators"},{"link":"physics/subjects/cond-matt","label":"Condensed Matter Physics"}],"image":"//d22izw7byeupn1.cloudfront.net/journals/PHYSICS/synopses/images/10.1103/PhysRevB.95.165109"},{"actions":{},"id":"F82F559E-4E57-5EA2-F064-B94AFE5A9194","index":"content-v1-1","type":"article","score":0.2189774,"article_type":"synopsis","date":"2017-04-05","date_label":"April  5, 2017","citation":"","journal":"Physics","doi":null,"features":[],"summary":null,"title":"Synopsis: Small Particles Untangle Polymer Chains","link":"/synopsis-for/10.1103/PhysRevLett.118.147801","teaser":"Adding nanoparticles to molten polymer disentangles its constituent molecular chains, allowing them to flow more easily.","subject_areas":[{"link":"physics/subjects/soft-matter","label":"Soft Matter"},{"link":"physics/subjects/nano","label":"Nanophysics"}],"image":"//d22izw7byeupn1.cloudfront.net/journals/PHYSICS/synopses/images/10.1103/PhysRevLett.118.147801"},{"actions":{},"id":"9B56A5CE-7F94-025E-D12A-3E3B23671420","index":"content-v1-1","type":"article","score":0.21832405,"article_type":"synopsis","date":"2017-04-04","date_label":"April  4, 2017","citation":"","journal":"Physics","doi":null,"features":[],"summary":null,"title":"Synopsis: Nonmetallic Tin Behaves Like 3D Graphene","link":"/synopsis-for/10.1103/PhysRevLett.118.146402","teaser":"By applying strain to a form of tin, researchers make it behave like a 3D analog of graphene.","subject_areas":[{"link":"physics/subjects/graphene","label":"Graphene"},{"link":"physics/subjects/top-insulator","label":"Topological Insulators"}],"image":"//d22izw7byeupn1.cloudfront.net/journals/PHYSICS/synopses/images/10.1103/PhysRevLett.118.146402"}],"facets":{"subject_area":{"optics":{"count":451,"value":"optics","label":"Optics"},"atomic-molecular":{"count":380,"value":"atomic-molecular","label":"Atomic and Molecular Physics"},"materials":{"count":300,"value":"materials","label":"Materials Science"},"particles-fields":{"count":286,"value":"particles-fields","label":"Particles and Fields"},"biological":{"count":227,"value":"biological","label":"Biological Physics"},"quantum-info":{"count":220,"value":"quantum-info","label":"Quantum Information"},"astrophysics":{"count":209,"value":"astrophysics","label":"Astrophysics"},"nano":{"count":207,"value":"nano","label":"Nanophysics"},"quantum":{"count":195,"value":"quantum","label":"Quantum Physics"},"fluids":{"count":189,"value":"fluids","label":"Fluid Dynamics"},"soft-matter":{"count":155,"value":"soft-matter","label":"Soft Matter"},"nuclear":{"count":150,"value":"nuclear","label":"Nuclear Physics"},"magnetism":{"count":143,"value":"magnetism","label":"Magnetism"},"interdisciplinary":{"count":140,"value":"interdisciplinary","label":"Interdisciplinary Physics"},"cosmology":{"count":126,"value":"cosmology","label":"Cosmology"},"superconductivity":{"count":112,"value":"superconductivity","label":"Superconductivity"},"semiconductor":{"count":109,"value":"semiconductor","label":"Semiconductor Physics"},"mesoscopics":{"count":108,"value":"mesoscopics","label":"Mesoscopics"},"nonlinear":{"count":92,"value":"nonlinear","label":"Nonlinear Dynamics"},"gravitation":{"count":86,"value":"gravitation","label":"Gravitation"},"spintronics":{"count":84,"value":"spintronics","label":"Spintronics"},"statistical":{"count":77,"value":"statistical","label":"Statistical Physics"},"chemical":{"count":73,"value":"chemical","label":"Chemical Physics"},"graphene":{"count":69,"value":"graphene","label":"Graphene"},"plasma":{"count":67,"value":"plasma","label":"Plasma Physics"},"cond-matt":{"count":54,"value":"cond-matt","label":"Condensed Matter Physics"},"metamaterials":{"count":52,"value":"metamaterials","label":"Metamaterials"},"strongly-correlated":{"count":48,"value":"strongly-correlated","label":"Strongly Correlated Materials"},"photonics":{"count":45,"value":"photonics","label":"Photonics"},"complex-systems":{"count":44,"value":"complex-systems","label":"Complex Systems"},"mechanics":{"count":43,"value":"mechanics","label":"Mechanics"},"electronics":{"count":38,"value":"electronics","label":"Electronics"},"acoustics":{"count":37,"value":"acoustics","label":"Acoustics"},"superfluids":{"count":36,"value":"superfluids","label":"Superfluidity"},"geophysics":{"count":33,"value":"geophysics","label":"Geophysics"},"energy":{"count":28,"value":"energy","label":"Energy Research"},"optoelectronics":{"count":22,"value":"optoelectronics","label":"Optoelectronics"},"industrial":{"count":20,"value":"industrial","label":"Industrial Physics"},"plasmonics":{"count":19,"value":"plasmonics","label":"Plasmonics"},"top-insulator":{"count":19,"value":"top-insulator","label":"Topological Insulators"},"phys-chem":{"count":18,"value":"phys-chem","label":"Physical Chemistry"},"strings":{"count":13,"value":"strings","label":"String Theory"},"medical":{"count":11,"value":"medical","label":"Medical Physics"},"computational":{"count":10,"value":"computational","label":"Computational Physics"}},"article_type":{"synopsis":{"count":1395,"value":"synopsis","label":"Synopsis"},"focus":{"count":1003,"value":"focus","label":"Focus"},"viewpoint":{"count":729,"value":"viewpoint","label":"Viewpoint"},"feature":{"count":44,"value":"feature","label":"Feature"},"editorial":{"count":32,"value":"editorial","label":"Editorial"},"trend":{"count":21,"value":"trend","label":"Trend"},"comment":{"count":1}}},"num_found":3229,"criteria":{"type":"article","sort":"recent","per_page":10,"page":1,"start_date":null,"end_date":null,"subject_area":null,"restrictions":{},"journal":["PHYSICS","FOCUS"],"facets":{"fields":["article_type","subject_area"]}},"page":1,"pages":[{"label":"\xab","value":1,"disabled":true},{"label":"1","value":1,"disabled":false,"active":true},{"label":"2","value":2,"disabled":false,"active":false},{"label":"3","value":3,"disabled":false,"active":false},{"label":"4","value":4,"disabled":false,"active":false},{"label":"5","value":5,"disabled":false,"active":false},{"label":"\u2026","value":"gap","disabled":true},{"label":"322","value":322,"disabled":false,"active":false},{"label":"323","value":323,"disabled":false,"active":false},{"label":"\xbb","value":2,"disabled":false}],"per_page":10};</script>'
s1 = s.split('window.results', 1)[1]
s2 = s1.split(':',1)[1]
s3 = s2.split(',"facets":{')[0]
parse_aps(s3)
a = 5


